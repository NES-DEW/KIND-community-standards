{
  "hash": "e32f476c16eb2d23b551aaacd3efaa35",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: R beginner's club 2024-09-12\nexecute: \n  output: markdown\n  echo: true\n  freeze: auto\n---\n\n\n\n\n## Help! I'm usually unable to run code that people send me\n\nThis can be really difficult, because you generally need your code to run at least a bit before you can find error messages. Three areas to try if you can't get anything to behave itself.\n\n### Check that your R setup isn't broken\n\nYou can try running something dead simple in the console to get a quick idea if your R installation is working at all (`2+2` is perfect). If that doesn't work, and assuming that you're using RStudio/Posit a sensible sequence of steps might be: + to restart R (`Ctrl` + `Shift` + `F10`) + or to terminate R (from the `Session` menu) + refresh the page (for the web version) or reopen Rstudio\n\nIf none of that works, the chances are that you're going to need to refer to your IT/eHealth colleagues, as it looks like something big and serious is broken.\n\n### Package loading\n\nAnother area where things often misfire is package loading. If you're getting unexpected `could not find function \"xxxx\"` errors, I'd be looking to check package loading.\n\nIf you're only using a few packages, make sure that you've done then `install.packages()` / `library()` dance to ensure both that packages are installed and attached. That gets boring and error prone if you're trying to sort out loads of packages, and it might be easier to use pacman to manage packages:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"pacman\")\nlibrary(pacman)\n```\n:::\n\n\n\n\nThen replace your calls to `library(packagename)` with calls to `p_load(packagename)`. `p_load` has the advantage that it will install missing packages, and then attach them, which makes for much less messing around with installing then attaching.\n\n### Working directory / `setwd()` / project\n\nThis is another area where scripts can completely fail. Wherever possible, R code is best run in a project, which takes care of most of the problems with setting paths and translating them across computers.\n\n## Is there a nice way to write formatted dates to xlsx/csv?\n\nYes, there is. In fact, there are a couple of ways of doing it. The 'proper' way for Excel is to use the `openxlsx` package to set a date format. This is great when it works, but pretty complicated to set up. And I need to extend thanks to Kirsty Mangin (NHS Golden Jubilee) for coming to the rescue with the following code:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(openxlsx)\ndat <- readxl::read_xlsx(\"s01_data.xlsx\") # here's the data we want to format\n\nfilename <- \"openxlsx.xlsx\" # for the new .xlsx file we're going to create\nwb <- createWorkbook(title = filename) # create an openxlsx workbook object in R\naddWorksheet(wb = wb, \"sheet one\") # add a worksheet to that book named \"sheet one\"\nwriteData(wb = wb, \n          x = dat,\n          sheet= \"sheet one\", \n          startCol=1, \n          startRow=1, \n          colNames=TRUE) # write the data into that worksheet\n\ndate_style <- createStyle(\n  fgFill = '#FFFFCC',\n  numFmt = \"dd/mm/yyyy\",\n  border = 'TopBottomLeftRight',\n  borderStyle = 'thin') # then create a date style\n\naddStyle(wb, \n         sheet=\"sheet one\", \n         date_style,  \n         gridExpand=T, \n         cols = 1, \n         rows = 1:nrow(dat)) # then apply that date style\n\nsaveWorkbook(wb, \"styled.xlsx\") # finally, save the workbook\n```\n:::\n\n\n\n\n![Lovely styled dates](images/clipboard-155178885.png)\n\nThis is fantastic, but bulky. If you're after something more casual (and more .csv friendly) you can convert your date to a formatted text string using lubridate:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreadxl::read_xlsx(\"data/s01_data.xlsx\") |>\n  dplyr::mutate(nice_date = lubridate::stamp_date(\"Jan 13 2021\")(date)) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1,500 × 6\n   date                WardName OccupiedBeds BedComp ClosedBed nice_date  \n   <dttm>              <chr>           <dbl>   <dbl>     <dbl> <chr>      \n 1 2022-11-02 00:00:00 A                  16      20         2 Nov 02 2022\n 2 2022-11-02 00:00:00 B                  20      20         0 Nov 02 2022\n 3 2022-11-02 00:00:00 C                  21      22         1 Nov 02 2022\n 4 2022-11-02 00:00:00 D                  25      30         2 Nov 02 2022\n 5 2022-11-02 00:00:00 E                  15      22         3 Nov 02 2022\n 6 2022-11-03 00:00:00 A                  14      20         0 Nov 03 2022\n 7 2022-11-03 00:00:00 B                  19      20         3 Nov 03 2022\n 8 2022-11-03 00:00:00 C                  18      22         0 Nov 03 2022\n 9 2022-11-03 00:00:00 D                  26      30         0 Nov 03 2022\n10 2022-11-03 00:00:00 E                  13      22         0 Nov 03 2022\n# ℹ 1,490 more rows\n```\n\n\n:::\n:::\n\n\n\n\n## Any tips for working in R with limited RAM?\n\nThis was an inquiry from someone trying to work in R in Windows with 8gB of RAM. That's going to be a challenge, unfortunately, especially if you need to run other memory-hungry stuff concurrently (Teams, e.g). R doesn't have much in the way of memory management, so aside from patience, the general advice is to keep e.g. the data that you're working with as small as possible. You'll usually load your working data into memory, and so if that data is larger than the available memory R will slow to a crawl as it's forced to write that data back to disk again.\n\nOne important exception: R gets very memory-inefficient if you grow objects. If you've got a choice between growing an object:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\na <- vector(\"numeric\")\n\nfor (i in 1:100){\n  a <- c(a, i)\n}\n```\n:::\n\n\n\n\nOr creating an object, and then assigning into it:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nb <- vector(\"numeric\", 100L)\nfor (i in 1:100){\n  b[i] <- i\n}\n```\n:::\n\n\n\n\nYou should always choose the latter.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}